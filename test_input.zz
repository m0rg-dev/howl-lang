module TestInput;

static fn i32 puts(*i8 s);
static fn *i8 realloc(*i8 ptr, i64 size);

class String {
    *i8 buffer;
    i64 length;
    i64 allocated_length;

    fn void setCharacter(i64 offset, i8 c) {
        if offset < self.length {
            self.buffer*[offset] = c;
        }
        return;
    }

    fn void pushCharacter(i8 c) {
        if self.allocated_length < (self.length + 1) {
            self.allocated_length = (self.allocated_length * 2) + 1;
            self.buffer = realloc(self.buffer, self.allocated_length);
        }
        self.buffer*[self.length] = c;
        self.length = self.length + 1;
        return;
    }

    fn *i8 c_str() {
        return self.buffer;
    }
}

static fn i32 main() {
    let s String;
    s = new String;
    s.pushCharacter(72);
    s.pushCharacter(101);
    s.pushCharacter(108);
    s.pushCharacter(108);
    s.pushCharacter(111);
    s.pushCharacter(44);
    s.pushCharacter(32);
    s.pushCharacter(87);
    s.pushCharacter(111);
    s.pushCharacter(114);
    s.pushCharacter(108);
    s.pushCharacter(100);
    s.pushCharacter(33);
    puts(s.c_str());
    return 0;
}

