module Test2;

class Vec<T> {
    *T value;
    i64 length;
    i64 element_size;

    fn void constructor() {
        self.value = fficall malloc(0);
        self.element_size = fficall sizeof(self.value[0]);
        self.length = 0;
    }

    fn T __index__(i64 idx) {
        return self.value[idx];
    }

    fn void __l_index__(i64 idx, T value) {
        if (idx > self.length) {
            self.value = fficall realloc(self.value, self.element_size * idx);
        }
        self.value[idx] = value;
    }
}

class HoldsVec<T> {
    Vec<T> value;

    fn void constructor() {
        self.value = new Vec();
    }

    fn T __index__(i64 idx) {
        return self.value[idx];
    }

    fn void __l_index__(i64 idx, T value) {
        self.value[idx] = value;
    }
}

static fn i32 main() {
    let HoldsVec<i32> foo;
    foo = new HoldsVec<i32>();
    foo[420] = 69;
    return foo[420];
}
